<!DOCTYPE html>
<html lang="en-us" class="scroll-smooth">
    <head><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arch Linux instal</title>
<meta name="description" content="Arch is great">
<link rel="canonical" href="https://suikaremilia.github.io/posts/arch-linux-install/">
<link rel="robots" href="/robots.txt" />
<link rel="stylesheet" href="https://suikaremilia.github.io/css/main.min.df1b948651de2b50af2bded0966d2d08b2a7217f36cbc0e2aaaaa9a7d2a94144.css" integrity="sha256-3xuUhlHeK1CvK97Qlm0tCLKnIX82y8Diqqqpp9KpQUQ=">
</head>
    <body class="max-w-screen-md px-10 mx-auto"><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
    

<figure class="flex-none w-20 h-20 rounded-full overflow-hidden" ><a href="https://suikaremilia.github.io/"><img srcset="/img/firefox_hub66cb162f84e73856336c19b5d2d497e_36921_80x80_fill_q90_box_smart1.jpg 80w" src="/img/firefox.jpg" width="640" height="640" alt="Red Panda YOLO"></a></figure>

    <div class="flex flex-col gap-5">
    <a href="https://suikaremilia.github.io/">
    
    <h3 class="text-center sm:text-left text-4xl font-extrabold text-gray-800 ">Red Panda YOLO</h3>
    
</a>
    <nav>
    <ul class="flex flex-wrap justify-center uppercase text-xs font-semibold gap-7 text-gray-500 ">
        
        
        <li class="hover:text-gray-500"><a href="/">Home</a></li>
        
        <li class="hover:text-gray-500"><a href="/posts">Posts</a></li>
        
        <li class="hover:text-gray-500"><a href="/murmur">Ｍurmur</a></li>
        
        <li class="hover:text-gray-500"><a href="/tags">Tags</a></li>
        
    </ul>
</nav>
    </div>
</header><div id="content">
<article class="flex flex-col gap-10">
    <header class="flex flex-col gap-2">
        <h2 class="text-4xl leading-snug font-bold text-gray-900">Arch Linux instal</h2>

        <div class="text-sm font-semibold text-gray-500 flex gap-3">
        
<time datetime="2020-03-08 17:48:42 &#43;0000 UTC" title="2020-03-08 17:48:42 &#43;0000 UTC">
    8 March 2020
</time>
        
        —
        
            <a class="hover:text-gray-500" href="/categories/tech/" alt="Tech" >
                Tech
                </a>
        

        </div>
    </header>
    <section class="content text-lg text-gray-800">
    <p>主力的本子用ARCH工作已经几年了，一直没有问题，有问题也都是能解决的问题。所以是出于莫名其妙的原因吧，在这个假期把arch重装了一下。跟几年前有些许变化，趁还有日志，记录一下过程。</p>
<h3 id="一环境准备">一、环境准备：</h3>
<p>设置bios为UEFI启动，各主机情况不同，一般是开机按F2进主板进行设置，设置的同时在boot里将从其他设备启动的选项打开；<br>
现在没有本子不是UEFI启动了吧，如果有就去看官方文档吧，这篇不适合做参考。<br>
下载最新的arch linux的<a href="https://www.archlinux.org/download/">ISO镜像</a>，然后制作启动U盘。<br>
我是在现有的arch上用dd做的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>dd if=archlinux.iso of=/dev/sdb bs=1M
</span></span></code></pre></div><p>然后，用U盘引导启动，进入live CD的系统后再确认一下启动方式是什么：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># ls  /sys/firmware/efi/efivars
</span></span></code></pre></div><p>如果此目录下有文件则为UEFI，否则请重新检查bios设置。<br>
国内的主机默认美国键盘就好，不需要做任何更改。</p>
<h3 id="二连接到网络">二、连接到网络：</h3>
<p>有线默认是dhcp的，插上网线自动获取地址即可，无线稍微复杂一点，可选的工具也很多，我习惯用netctl这工具。<br>
检查网卡名称：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ip link
</span></span></code></pre></div><p>拷贝并修改配置文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># cp /etc/netctl/examples/wireless-wpa /etc/netctl/ihangzhou
</span></span><span style="display:flex;"><span># vim /etc/netctl/ihangzhou
</span></span></code></pre></div><p>修改了以下标记了的内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#b8860b">Description</span><span style="color:#666">=</span><span style="color:#b44">&#39;A simple WPA encrypted wireless connection&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Interface</span><span style="color:#666">=</span>~~wlp2s0~~
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Connection</span><span style="color:#666">=</span>wireless
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Security</span><span style="color:#666">=</span>wpa
</span></span><span style="display:flex;"><span><span style="color:#b8860b">IP</span><span style="color:#666">=</span>dhcp
</span></span><span style="display:flex;"><span><span style="color:#b8860b">ESSID</span><span style="color:#666">=</span><span style="color:#b44">&#39;~~i-hangzhou~~&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Key</span><span style="color:#666">=</span><span style="color:#b44">&#39;~~xxxxxx~~&#39;</span>   
</span></span><span style="display:flex;"><span>wifi的密码
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># Uncomment this if your ssid is hidden</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Hidden</span><span style="color:#666">=</span>*~~yes~~*         
</span></span><span style="display:flex;"><span>是否是隐藏的网络，如不是则在此行前面加#将其注释掉，默认注就是注释的
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># Set a priority for automatic profile selection</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">Priority</span><span style="color:#666">=</span><span style="color:#666">10</span>
</span></span></code></pre></div><p>启用配置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd /etc/netctl/
</span></span><span style="display:flex;"><span>netctl start ihangzhou
</span></span></code></pre></div><p>如果没有报错应该就会获取到地址，有报错就检查一下哪里错了。<br>
确认一下地址，并看下联通性，这时候百度有了它唯一的用处：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># ip a
</span></span><span style="display:flex;"><span># ping www.baidu.com
</span></span></code></pre></div><h3 id="三磁盘分区">三、磁盘分区：</h3>
<p>磁盘分区和文件系统都算常识吧，有兴趣的去看wiki或google，此次只是记录下简单的使用GPT分区和brtfs的过程。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># parted /dev/sdx</span>
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>parted<span style="color:#666">)</span> mklabel gpt
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>parted<span style="color:#666">)</span> mkpart ESP fat32 1M 150M 
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>parted<span style="color:#666">)</span> <span style="color:#a2f">set</span> <span style="color:#666">1</span> boot on
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>parted<span style="color:#666">)</span> mkpart primary brtfs 151M 15G 
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>parted<span style="color:#666">)</span> mkpart primary brtfs 24.5G 100%
</span></span></code></pre></div><p><strong>将分区格式化：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># lsblk /dev/sdx
</span></span><span style="display:flex;"><span># mkfs.vfat -F32 /dev/sdxY
</span></span><span style="display:flex;"><span># mkfs.brtfs /dev/sdxZ
</span></span></code></pre></div><p><strong>创立挂载点并挂载分区：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># mount /dev/sdxZ /mnt
</span></span><span style="display:flex;"><span>根分区要先挂载，然后再创建其他挂载点
</span></span><span style="display:flex;"><span># mkdir /mnt/home
</span></span><span style="display:flex;"><span># mount /dev/sdxW /mnt/home
</span></span><span style="display:flex;"><span># mkdir -p /mnt/boot
</span></span><span style="display:flex;"><span># mount /dev/sdXY /mnt/boot
</span></span></code></pre></div><p>我没有创建swap分区，我觉得内存足够大够用了。</p>
<h3 id="四安装系统">四、安装系统：</h3>
<p><strong>选用合适的安装镜像地址</strong><br>
要根据网络情况来调整，列表中排的越靠前的镜像站优先级越高，同时理论地理位置越近的镜像站速度越快，国内墙是主要考虑因素，按实际情况调整即可，以获得尽量大的下载速度为主要目标。<br>
更改镜像列表后请务必强制刷新。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># vim /etc/pacman.d/mirrorlist
</span></span><span style="display:flex;"><span># pacman -Syy
</span></span></code></pre></div><p><strong>安装基本软件包</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pacstrap /mnt base linux linux-firmware
</span></span></code></pre></div><p>此处也可以同时安装其他的软件包，把包名加在后面即可</p>
<p><strong>生成 fstab：</strong><br>
最好用-U参数，使用设备UUID而不是别名进行挂载</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></div><h3 id="五配置环境">五、配置环境：</h3>
<p>进入安装好的系统：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># arch-chroot /mnt
</span></span></code></pre></div><p><strong>调整时间：</strong><br>
开启NTP同步：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># timedatectl set-ntp true
</span></span></code></pre></div><p>选择时区：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># tzselect
</span></span><span style="display:flex;"><span># ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span></code></pre></div><p>同步硬件时间：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># hwclock --systohc
</span></span></code></pre></div><p><strong>本地化设置：</strong><br>
locale.gen 与 locale.conf两个文件，规定地域、货币、时区日期的格式、字符排列方式和其他本地化标准等等，非常重要。</p>
<p><code>/etc/locale.gen</code>是一个仅包含注释文档的文本文件。指定需要的本地化类型，只需移除对应行前面的注释符号（＃）即可，建议选择带UTF-8的选项，之后再生成locale信息：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># vim /etc/locale.gen</span>
</span></span><span style="display:flex;"><span>en_US.UTF-8 UTF-8
</span></span><span style="display:flex;"><span>zh_CN.UTF-8 UTF-8
</span></span><span style="display:flex;"><span>zh_TW.UTF-8 UTF-8
</span></span><span style="display:flex;"><span>ja_JP.UTF-8 UTF-8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># locale-gen</span>
</span></span></code></pre></div><p>创建 locale.conf 并提本地化选项：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># echo LANG=en_US.UTF-8 &gt; /etc/locale.conf
</span></span></code></pre></div><p><strong>创建初始ramdisk环境:</strong><br>
打开需要的钩子，比如lvm什么的，然后生成Initramfs</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># vim /etc/mkinitcpio.conf 
</span></span><span style="display:flex;"><span># mkinitcpio -p linux
</span></span></code></pre></div><p><strong>设置root密码：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># passwd
</span></span></code></pre></div><p><strong>安装启动器：</strong><br>
再次确认一下分区挂载情况，尤其是boot分区，不正确还可以调整：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># lsblk
</span></span></code></pre></div><p>启动器有很多可选，grub2太传统，这次选择了syslinux，如果要好看可以选rEFInd。<br>
<del>我才不会说是搞了半天搞不定rEFInd才换syslinux的，逃</del></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pacman -S syslinux
</span></span><span style="display:flex;"><span># syslinux-install_update -i -a -m
</span></span></code></pre></div><p><strong>安装其他包：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pacman -S networkmanager wpa_supplicant dialog bash-completion dhcpd
</span></span></code></pre></div><p><strong>重启进入系统：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># exit
</span></span><span style="display:flex;"><span># reboot
</span></span></code></pre></div><p><strong>其他设置：</strong><br>
联网：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># nmtui
</span></span></code></pre></div><p>设置主机名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># hostnamectl set-hostname XXX
</span></span></code></pre></div><p>添加管理员帐号：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># useradd -m -g users -G wheel -s /bin/bash xxx
</span></span><span style="display:flex;"><span># passwd xxx
</span></span></code></pre></div><p><strong>更新一下系统：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pacman -Syyu
</span></span></code></pre></div><p>然后就完成了，后面图形什么的是另外的事。<br>
我用了xfce4做图形桌面，fcitx做输入法，挺好用的。</p>
<h3 id="六其他工具">六、其他工具：</h3>
<p>如今arch的安装其实很简单，手操一遍有助于对linux工作方式和启动的理解。如果不想手动的操作，github上有专门的辅助部署的项目，比较完善的有<a href="https://github.com/helmuthdu/aui">helmuthdu/aui</a>连后面的图形和软件一起都搞定了，只有你能进入live CD环境并联网。</p>
<blockquote>
<p><a href="https://wiki.archlinux.org/index.php/Installation_guide">https://wiki.archlinux.org/index.php/Installation_guide</a><br>
<a href="https://wiki.archlinux.org/index.php/General_recommendations">https://wiki.archlinux.org/index.php/General_recommendations</a><br>
<a href="https://wiki.archlinux.org/index.php/List_of_applications">https://wiki.archlinux.org/index.php/List_of_applications</a><br>
<a href="https://telegra.ph/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85ARCH-LINUX-07-18">https://telegra.ph/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85ARCH-LINUX-07-18</a></p>
</blockquote>

    
        <div class="pb-14 taxonomy-list tags-list text-gray-600 text-sm font-medium">
            
                    <a class="bg-gray-100 py-2 px-3 rounded-lg" href="/tags/arch/" alt="Arch" >
                        Arch
                    </a>
            
        </div>


    </section>
    
    
    
        <div class="giscus-comment">
    <script
      src="https://giscus.app/client.js"
      data-repo="suikaremilia/suikaremilia.github.io"
      data-repo-id="R_kgDOHZJINw"
      data-category="Announcements"
      data-category-id="DIC_kwDOHZJIN84CYPk_"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="light"
      data-lang="zh-CN"
      
        data-loading="lazy"
      
      crossorigin="anonymous"
      async
    ></script>
</div>
    

    
    

    <footer>

    </footer>
</article>

        </div><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1 ">
    © 2023 — <a class="hover:text-gray-500" href="https://suikaremilia.github.io/">Long life, short world, trading of time, long strangle, hedging bets</a> <span class=" font-normal ">
</div>
    <div class="text-xs font-semibold text-gray-500 order-1 sm:order-2">
    <ul class="flex sm:justify-end gap-5">
    <li><a class="hover:text-gray-500" href="https://t.me/touhoumichong" target="_blank" rel="noopener noreferrer">Telegram</a></li><li><a class="hover:text-gray-500" href="mailto:suika@kadama.eu.org" target="_blank" rel="noopener noreferrer">Mail</a></li><li><a class="hover:text-gray-500" href="/index.xml" target="_blank" rel="noopener noreferrer">RSS</a></li>
    </ul>
</div>
</footer></body>
</html>
