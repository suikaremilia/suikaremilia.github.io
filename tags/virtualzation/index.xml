<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Virtualzation on すいかの幻想郷</title>
        <link>https://example.com/tags/virtualzation/</link>
        <description>Recent content in Virtualzation on すいかの幻想郷</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Tue, 12 May 2020 11:19:16 +0000</lastBuildDate><atom:link href="https://example.com/tags/virtualzation/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>封装虚拟机</title>
        <link>https://example.com/post/%E5%B0%81%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA/</link>
        <pubDate>Tue, 12 May 2020 11:19:16 +0000</pubDate>
        
        <guid>https://example.com/post/%E5%B0%81%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA/</guid>
        <description>&lt;p&gt;很多时候我们需要重复创建虚机，模板就是方便此类重复操作的一个虚机副本。模板不能拥有任何特定的信息，否则依此建立的虚机将都带有特定信息。所以，在建立模板前需要对源虚机进行封装，所谓封装就是在保证其他功能正常的同时，去除掉特点的功能。&lt;br&gt;
以前linux通用的封装方式比较烦，需要手动删除如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ssh主机密钥：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm -rf /etc/ssh/ssh_host_*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;设置hostname为localhost&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat /etc/sysconfig/network
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;localhost.localdomain
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;从/var/log中删除所有日志：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;find .-name &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; cat /dev/null&amp;gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;/root中删除build日志：&lt;/li&gt;
&lt;li&gt;关闭虚机&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;现在rhel提供了更简便的封装方法：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install -y libguestfs-tools
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virt-sysprep
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;windows的封装一向很简单：&lt;/strong&gt;&lt;br&gt;
运行sysprep.exe&lt;br&gt;
一般在C:\Windows\System32\sysprep\sysprep.exe&lt;/p&gt;
&lt;p&gt;此类是通用的封装方法，有虚拟化平台提供自己的封装工具，那么以平台为准。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>虚拟机镜像转换</title>
        <link>https://example.com/post/%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%95%9C%E5%83%8F%E8%BD%AC%E6%8D%A2/</link>
        <pubDate>Fri, 08 May 2020 11:00:23 +0000</pubDate>
        
        <guid>https://example.com/post/%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%95%9C%E5%83%8F%E8%BD%AC%E6%8D%A2/</guid>
        <description>&lt;p&gt;总会遇到诡异的问题，比如要部署厂家打包好的定制化的镜像，发现这镜像只提供一种平台的格式，这时候就需要将虚拟磁盘做转换了。&lt;br&gt;
各个厂家提供一些定制化的工具并不是太通用，比如VMWare的vmware-vdiskmanager，好在这个世界有开源的qemu-img工具，可以方便的转换各种格式的镜像。&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装：&lt;/h2&gt;
&lt;p&gt;qemu-img提供多平台支持，常见的windows可以从&lt;a class=&#34;link&#34; href=&#34;https://qemu.weilnetz.de&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;官网&lt;/a&gt;下载安装；linux就更简单了，配源然后install，比如：&lt;code&gt;yum install qemu-img&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;参数&#34;&gt;参数：&lt;/h2&gt;
&lt;p&gt;常用的转换参数如下：&lt;/p&gt;
&lt;p&gt;convert：转换操作；&lt;br&gt;
-p：显示转换进度;&lt;br&gt;
-f xxx：指明被转换镜像的格式，可以留空，但hyperV的vhd最好写明vpc否则可能不识别；&lt;br&gt;
-O xxx：表明要转换成的格式；&lt;br&gt;
info：查询信息&lt;/p&gt;
&lt;h2 id=&#34;实例&#34;&gt;实例：&lt;/h2&gt;
&lt;p&gt;vmdk转qcow2：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;qemu-img convert -p -f vmdk -O qcow2 RHEL.vmdk RHEL.qcow2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;查询镜像详细信息：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;qemu-img info RHEL.qcow2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;如果转vhd文件，注意&lt;code&gt;-f&lt;/code&gt;后跟&lt;code&gt;vpc&lt;/code&gt;而不是&lt;code&gt;vhd&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以上没有了……&lt;/p&gt;
</description>
        </item>
        <item>
        <title>部署RHHI环境</title>
        <link>https://example.com/post/%E9%83%A8%E7%BD%B2rhhi%E7%8E%AF%E5%A2%83/</link>
        <pubDate>Tue, 05 May 2020 13:57:26 +0000</pubDate>
        
        <guid>https://example.com/post/%E9%83%A8%E7%BD%B2rhhi%E7%8E%AF%E5%A2%83/</guid>
        <description>&lt;p&gt;一直不知道为啥红帽会把RHHI放进存储产品线，明明就是个虚拟化环境的超融合环境，甚至安装介质跟rhv都是一样的，两者只有部署方式上的差异。&lt;br&gt;
从最开始的RHV一直用到现在的RHHI，红帽的产品没有VMWare那么丰富的接口，却也别有特色，用习惯了感觉也不错。&lt;del&gt;才不是用多了国产的烂玩意才有的这种感觉。&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;这两天环境被弄乱了，就图省事不修了，重新部署了一套了事，记录一点过程：&lt;/p&gt;
&lt;p&gt;首先，要有RHVH的订阅，没有就去下ovirt，rhv对应的开源版本就是它；&lt;br&gt;
其次，红帽对此的文档已经很详细了，也不需要帐号就可以阅读，相关的两篇文档如下：&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure_for_virtualization/1.7/html/deploying_red_hat_hyperconverged_infrastructure_for_virtualization/deployment_workflow#enabling-software-repositories&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure_for_virtualization/1.7/html/deploying_red_hat_hyperconverged_infrastructure_for_virtualization/deployment_workflow#enabling-software-repositories&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4-beta/html/administration_guide/sect-preparing_and_adding_nfs_storage&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4-beta/html/administration_guide/sect-preparing_and_adding_nfs_storage&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;注意，第一篇部署文档里没提到的是宿主机的主机名需要被DNS解析，否则部署host-engin的时候会过不去地址检测。&lt;br&gt;
第二篇文档要注意的是nfs的权限设置，不是随便哪个nfs都能在rhv环境中挂起来的。&lt;br&gt;
然后，按照文档部署完成之后要在compute-&amp;gt;cluster里把enable gluster service的勾勾上，不然在storage-&amp;gt;volumes里管理不到先前创建的gluster卷。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://example.com/post/%E9%83%A8%E7%BD%B2rhhi%E7%8E%AF%E5%A2%83/1592294025923.png&#34;
	width=&#34;1323&#34;
	height=&#34;868&#34;
	srcset=&#34;https://example.com/post/%E9%83%A8%E7%BD%B2rhhi%E7%8E%AF%E5%A2%83/1592294025923_hu1b89246d9a1adf3285e7b197df493f9a_30833_480x0_resize_box_3.png 480w, https://example.com/post/%E9%83%A8%E7%BD%B2rhhi%E7%8E%AF%E5%A2%83/1592294025923_hu1b89246d9a1adf3285e7b197df493f9a_30833_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;152&#34;
		data-flex-basis=&#34;365px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;最后，就可以慢慢用了，从rhv2到3再到如今的4.3，改变还是蛮大的，也明显越来越好用了。虽然不是主流产品，但是如果有超融合需求，不妨尝试一下，毕竟有免费的开源版本ovirt。&lt;br&gt;
但是4.3的RHV有个最坑的地方，由于宿主机是基于RHEL7的系统，因此无法将RHEL8的系统做成模板，因为rhel8中xfs有新特性，而这点居然写在了RHV4.4的文档里，而不是4.3的……&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
